#!/bin/bash

exec > ${MODULE_STATE}/hosts

echo "# generated by 15hosts"
echo "127.0.0.1 localhost.localdomain localhost"

# XXX: get the list of the nsdc module instances Redis itself
for k in nsdc0 nsdc1 nsdc2 nsdc3; do
    (
        source <(redis-hgetall "module/${k}/module.env")
        if [[ -n ${IPADDRESS} && -n ${HOSTNAME} ]]; then
            echo "${IPADDRESS} ${HOSTNAME}"
        fi
    )
done
